<script src="https://unpkg.com/gpu.js@latest/dist/gpu-browser.min.js
"></script>
<!-- <script type="module" src="/src/htmlSolver.js"></script>/ -->
<script type="module">
  import * as htmlSolver from "/src/htmlSolver.js";
  window.htmlSolver = htmlSolver;

  const gpu = new GPU({
    mode: "gpu",
  });

  const SIZE = 500;

  const solver = new htmlSolver.Solver(gpu, SIZE);

  const iterate = (result0) => {
    // console.log('result0', result0.toArray().map(v => [...v]))

    const result1 = solver.kernel1(result0);
    // console.log('result1', result1.toArray().map(v => [...v]))
    result0.delete();

    const result2 = solver.kernel2(result1);
    // console.log('result2', result2.toArray().map(v => [...v]))
    result1.delete();

    solver.render(result2);
    return result2;
  };

  let result = solver.initialKernel();
  let n = 0;
  const animate = () => {
    n++;
    // console.log(n);
    result = iterate(result);
    requestAnimationFrame(animate);
  };

  animate();

</script>